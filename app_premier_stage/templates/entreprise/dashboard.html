{% extends "base.html" %}
{% block title %}Tableau de bord - Entreprise{% endblock title %}
{% block content %}
{% include "entreprise/header.html" %}

<main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <!-- SECTION : Statistiques -->
  <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
    <!-- Stat 1 -->
    <div class="bg-white rounded-lg shadow-md p-6 flex items-center space-x-4 hover:shadow-lg transition">
      <div class="w-12 h-12 bg-primary-blue text-white rounded-full flex items-center justify-center">
        <i class="fas fa-briefcase"></i>
      </div>
      <div>
        <p class="text-sm text-gray-500">Offres Actives</p>
        <p class="text-xl font-bold text-gray-900">{{ offres_actives }}</p>
      </div>
    </div>

    <!-- Stat 2 -->
    <div class="bg-white rounded-lg shadow-md p-6 flex items-center space-x-4 hover:shadow-lg transition">
      <div class="w-12 h-12 bg-primary-orange text-white rounded-full flex items-center justify-center">
        <i class="fas fa-users"></i>
      </div>
      <div>
        <p class="text-sm text-gray-500">Candidatures reçues</p>
        <p class="text-xl font-bold text-gray-900">{{ candidatures_total }}</p>
      </div>
    </div>

    <!-- Stat 3 -->
    <div class="bg-white rounded-lg shadow-md p-6 flex items-center space-x-4 hover:shadow-lg transition">
      <div class="w-12 h-12 bg-green-500 text-white rounded-full flex items-center justify-center">
        <i class="fas fa-user-check"></i>
      </div>
      <div>
        <p class="text-sm text-gray-500">Candidats présélectionnés</p>
        <p class="text-xl font-bold text-gray-900">{{ candidats_preselectionnes }}</p>
      </div>
    </div>

    <!-- Stat 4 -->
    <div class="bg-white rounded-lg shadow-md p-6 flex items-center space-x-4 hover:shadow-lg transition">
      <div class="w-12 h-12 bg-yellow-500 text-white rounded-full flex items-center justify-center">
        <i class="fas fa-calendar-alt"></i>
      </div>
      <div>
        <p class="text-sm text-gray-500">Entretiens planifiés</p>
        <p class="text-xl font-bold text-gray-900">{{ entretiens_planifies }}</p>
      </div>
    </div>
  </section>

  <!-- SECTION Mes Offres -->
  <section class="mb-12">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl font-bold text-primary-blue">Mes Offres</h2>
      <a href="{% url 'offrecree' %}" class="bg-primary-orange hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
        + Créer une nouvelle offre
      </a>
    </div>
    
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Titre</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Filière</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Localisation</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statut</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidatures</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for offre in offres %}
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">{{ offre.titre_offre }}</div>
                <div class="text-sm text-gray-500">Publié le {{ offre.created_at|date:"d/m/Y" }}</div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="bg-blue-100 text-primary-blue px-2 py-1 rounded-full text-xs font-medium">{{ offre.filiere }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{{ offre.localisation }}</td>
              <td class="px-6 py-4 whitespace-nowrap">
                {% if offre.active %}
                  <span class="bg-green-100 text-green-700 px-2 py-1 rounded-full text-xs font-medium">Active</span>
                {% else %}
                  <span class="bg-red-100 text-red-700 px-2 py-1 rounded-full text-xs font-medium">Inactive</span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                <span class="font-medium">{{ offre.candidatures.count }}</span> candidatures
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                <a href="{% url 'modifier_offre' offre.id_offre %}" class="text-primary-blue hover:text-blue-800">Modifier</a>
                <a href="{% url 'supprimer_offre' offre.id_offre %}" class="text-red-600 hover:text-red-800">Supprimer</a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="px-6 py-4 text-center text-gray-500">Aucune offre publiée.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- SECTION Profils diplômés -->
  <section>
    <h2 class="text-2xl font-bold text-primary-blue mb-6">Profils de diplômés</h2>

    <!-- Barre recherche -->
    <form method="get" class="bg-white rounded-lg shadow-md p-6 mb-6">
      <div class="flex flex-col md:flex-row gap-4">
        <div class="flex-1">
          <select name="filiere" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-orange">
            <option value="">Toutes les filières</option>
            {% for filiere in filieres %}
              <option value="{{ filiere }}">{{ filiere }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="flex-1">
          <input type="text" name="q" placeholder="Rechercher par nom ou établissement..." 
                 class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-orange">
        </div>
        <button type="submit" class="bg-primary-orange hover:bg-orange-600 text-white px-6 py-2 rounded-lg font-medium transition-colors">
          Rechercher
        </button>
      </div>
    </form>

    <!-- Liste CVs -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for stagiaire in stagiaires %}
      <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
        <div class="flex items-center mb-4">
          <div class="w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center mr-4">
            <span class="text-gray-600 font-medium">{{ stagiaire.nom_stagiaire|slice:":1" }}{{ stagiaire.prenom_stagiaire|slice:":1" }}</span>
          </div>
          <div>
            <h3 class="font-semibold text-gray-900">{{ stagiaire.nom_stagiaire }} {{ stagiaire.prenom_stagiaire }}</h3>
            <p class="text-sm text-gray-600">{{ stagiaire.filiere_stagiaire }}</p>
          </div>
        </div>
        <p class="text-sm text-gray-600 mb-2">{{ stagiaire.etablissement }}</p>
        <p class="text-sm text-gray-600 mb-4">Téléphone : {{ stagiaire.telephone_stagiaire }}</p>
        <div class="flex items-center justify-between">
          <span class="bg-blue-100 text-primary-blue px-2 py-1 rounded-full text-xs font-medium">Disponible</span>
          {% if stagiaire.cv_stagiaire %}
            <a href="{{ stagiaire.cv_stagiaire.url }}" target="_blank"
               class="bg-primary-orange hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
              Voir CV
            </a>
          {% endif %}
        </div>
      </div>
      {% empty %}
      <p class="text-gray-500">Aucun profil trouvé.</p>
      {% endfor %}
    </div>
  </section>
</main>
{% endblock content %}
