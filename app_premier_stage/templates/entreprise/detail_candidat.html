{% extends "base.html" %}
{% block title %}Candidature - {{ candidature.stagiaire.nom_stagiaire }}{% endblock %}

{% block content %}
{% include "entreprise/header.html" %}

<main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-bold text-primary-blue mb-6">
            Candidature de {{ candidature.stagiaire.nom_stagiaire }} {{ candidature.stagiaire.prenom_stagiaire }}
        </h2>

        <!-- Infos candidat -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div>
                <p><strong>Email :</strong> {{ candidature.stagiaire.email_stagiaire }}</p>
                <p><strong>Téléphone :</strong> {{ candidature.stagiaire.telephone_stagiaire }}</p>
                <p><strong>Établissement :</strong> {{ candidature.stagiaire.etablissement }}</p>
                <p><strong>Filière :</strong> {{ candidature.stagiaire.filiere_stagiaire }}</p>
            </div>
            <div>
                <p><strong>Date de candidature :</strong> {{ candidature.date_postulation|date:"d/m/Y" }}</p>
                <p><strong>Statut actuel :</strong> 
                    <span class="font-semibold capitalize">{{ candidature.statut_candidature }}</span>
                </p>
                {% if candidature.stagiaire.cv_stagiaire %}
                <p class="mt-2">
                    <a href="{{ candidature.stagiaire.cv_stagiaire.url }}" target="_blank"
                       class="text-primary-orange hover:underline">📄 Voir le CV</a>
                </p>
                {% endif %}
            </div>
        </div>

        <!-- Actions -->
        <div class="border-t pt-6">
            {% if candidature.statut_candidature == "en attente" %}
                <div class="flex flex-wrap gap-4">
                    <!-- Accepter -->
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="statut" value="acceptée">
                        <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg">
                            ✅ Accepter
                        </button>
                    </form>

                    <!-- Refuser -->
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="statut" value="refusée">
                        <button type="submit" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg">
                            ❌ Refuser
                        </button>
                    </form>

                    <!-- Planifier entretien -->
                    <button onclick="toggleForm()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                        📅 Planifier entretien
                    </button>
                </div>

                <!-- Formulaire entretien -->
                <div id="formEntretien" class="hidden mt-6">
                    <form method="post" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% csrf_token %}
                        <input type="hidden" name="statut" value="entretien">
                        <div>
                            <label>Date entretien</label>
                            <input type="date" name="date_entretien" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label>Heure entretien</label>
                            <input type="time" name="heure_entretien" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div class="md:col-span-2 flex justify-end">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                                Confirmer
                            </button>
                        </div>
                    </form>
                </div>

            {% elif candidature.statut_candidature == "entretien" %}
                <p class="text-blue-600 font-semibold mb-4">
                    📅 Entretien prévu le {{ candidature.date_entretien|date:"d/m/Y" }} 
                    à {{ candidature.heure_entretien }}
                </p>
                <button onclick="toggleForm()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg">
                    ✏️ Modifier entretien
                </button>

                <!-- Formulaire modifier entretien -->
                <div id="formEntretien" class="hidden mt-6">
                    <form method="post" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% csrf_token %}
                        <input type="hidden" name="statut" value="entretien">
                        <div>
                            <label>Date entretien</label>
                            <input type="date" name="date_entretien" 
                                   value="{{ candidature.date_entretien|date:'Y-m-d' }}" 
                                   class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label>Heure entretien</label>
                            <input type="time" name="heure_entretien" 
                                   value="{{ candidature.heure_entretien|time:'H:i' }}" 
                                   class="w-full border rounded-lg px-3 py-2">
                        </div>
                        <div class="md:col-span-2 flex justify-end">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg">
                                Mettre à jour
                            </button>
                        </div>
                    </form>
                </div>

            {% elif candidature.statut_candidature == "acceptée" %}
                <p class="bg-green-100 text-green-700 px-4 py-2 rounded-lg font-medium">
                    ✅ Candidature acceptée
                </p>

            {% elif candidature.statut_candidature == "refusée" %}
                <p class="bg-red-100 text-red-700 px-4 py-2 rounded-lg font-medium">
                    ❌ Candidature refusée
                </p>
            {% endif %}
        </div>
    </div>
</main>

<script>
function toggleForm() {
    document.getElementById("formEntretien").classList.toggle("hidden");
}
</script>
{% endblock %}
